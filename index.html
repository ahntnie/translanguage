<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech to Text Demo (Web Speech API)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            text-align: center;
        }

        #transcript {
            font-size: 24px;
            color: #333;
            margin-top: 20px;
        }

        button {
            font-size: 16px;
            padding: 20px 40px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            position: relative;
            transition: all 0.3s;
        }

        button.recording {
            background-color: #f44336;
        }

        #status {
            font-size: 18px;
            margin-top: 10px;
            color: #f44336;
        }
    </style>
</head>

<body>

    <h1>Chuyển Giọng Nói Thành Văn Bản</h1>
    <p>Nhấn và giữ nút để thu giọng nói, bỏ tay ra để dừng thu âm và xem kết quả!</p>
    <button id="recordButton" onmousedown="startRecognition()" onmouseup="stopRecognition()"
        ontouchstart="startRecognition()" ontouchend="stopRecognition()">Bắt Đầu Thu Giọng Nói</button>

    <div id="status"></div>
    <div id="transcript">Văn bản sẽ xuất hiện tại đây...</div>

    <script>
        let recognition;
        let isRecording = false;
        let transcript = '';  // Lưu kết quả nhận diện tạm thời

        // Kiểm tra xem trình duyệt có hỗ trợ SpeechRecognition hay không
        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'vi-VN'; // Ngôn ngữ tiếng Việt
            recognition.continuous = true; // Nhận diện liên tục
            recognition.interimResults = true; // Hiển thị kết quả tạm thời
            recognition.maxAlternatives = 1; // Giới hạn kết quả, chỉ lấy kết quả tốt nhất
        } else {
            alert("Trình duyệt của bạn không hỗ trợ Web Speech API.");
        }

        // Hàm bắt đầu thu âm
        function startRecognition() {
            if (isRecording) return;  // Nếu đang thu âm thì không làm gì nữa

            isRecording = true;
            transcript = '';  // Reset lại transcript khi bắt đầu thu âm
            document.getElementById('recordButton').classList.add('recording');
            document.getElementById('status').innerText = "Đang thu âm...";
            document.getElementById('transcript').innerText = "Đang nhận diện...";

            recognition.start();

            // Lắng nghe kết quả nhận diện
            recognition.onresult = function (event) {
                // Lấy kết quả cuối cùng
                const newTranscript = event.results[event.results.length - 1][0].transcript;

                // Cập nhật transcript khi có kết quả tạm thời
                if (event.results[event.results.length - 1].isFinal) {
                    transcript += newTranscript + ' ';  // Cộng dồn vào transcript
                    document.getElementById('transcript').innerText = transcript;
                } else {
                    document.getElementById('transcript').innerText = newTranscript;
                }
            };

            recognition.onerror = function (event) {
                document.getElementById('status').innerText = `Lỗi: ${event.error}`;
            };

            recognition.onend = function () {
                if (isRecording) {
                    startRecognition(); // Tiếp tục nhận diện nếu chưa ngừng
                }
            };
        }

        // Hàm dừng thu âm
        function stopRecognition() {
            if (!isRecording) return;  // Nếu không đang thu âm thì không làm gì nữa

            isRecording = false;
            document.getElementById('recordButton').classList.remove('recording');
            document.getElementById('status').innerText = "Đã ngừng thu âm.";
            recognition.stop();
            document.getElementById('transcript').innerText = transcript; // Hiển thị kết quả cuối cùng
        }
    </script>

</body>

</html>
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech to Text Demo (Web Speech API)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            text-align: center;
        }

        #transcript {
            font-size: 24px;
            color: #333;
            margin-top: 20px;
        }

        button {
            font-size: 16px;
            padding: 20px 40px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            position: relative;
            transition: all 0.3s;
        }

        button.recording {
            background-color: #f44336;
        }

        #status {
            font-size: 18px;
            margin-top: 10px;
            color: #f44336;
        }
    </style>
</head>

<body>

    <h1>Chuyển Giọng Nói Thành Văn Bản</h1>
    <p>Nhấn nút để bắt đầu thu giọng nói hoặc dừng thu âm!</p>
    <button id="recordButton" onclick="toggleRecognition()">Bắt Đầu Thu Giọng Nói</button>

    <div id="status"></div>
    <div id="transcript">Văn bản sẽ xuất hiện tại đây...</div>

    <script>
        let recognition;
        let isRecording = false;
        let silenceTimeout; // Timeout để kiểm tra khi ngừng nói trong 3 giây

        // Kiểm tra xem trình duyệt có hỗ trợ SpeechRecognition hay không
        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'vi-VN'; // Ngôn ngữ tiếng Việt
            recognition.continuous = true; // Nhận diện liên tục
            recognition.interimResults = true; // Kết quả tạm thời (trong khi nói)
            recognition.maxAlternatives = 1
        } else {
            alert("Trình duyệt của bạn không hỗ trợ Web Speech API.");
        }

        // Hàm toggle thu âm (Bắt đầu hoặc dừng thu âm)
        function toggleRecognition() {
            if (isRecording) {
                stopRecognition();
            } else {
                startRecognition();
            }
        }

        // Hàm bắt đầu thu âm
        function startRecognition() {
            isRecording = true;
            document.getElementById('recordButton').classList.add('recording');
            document.getElementById('status').innerText = "Đang thu âm...";
            document.getElementById('transcript').innerText = "Đang nhận diện...";

            recognition.start();

            // Lắng nghe kết quả nhận diện
            recognition.onresult = function (event) {
                // Lấy kết quả cuối cùng
                const transcript = event.results[event.results.length - 1][0].transcript;

                // Chỉ lưu lại kết quả cuối cùng khi không còn kết quả tạm thời
                if (event.results[event.results.length - 1].isFinal) {
                    document.getElementById('transcript').innerText = transcript;
                    clearTimeout(silenceTimeout); // Dừng timeout nếu nhận diện hoàn tất
                } else {
                    // Khi có kết quả tạm thời, không làm gì cả
                }
            };

            recognition.onerror = function (event) {
                document.getElementById('status').innerText = `Lỗi: ${event.error}`;
            };

            recognition.onend = function () {
                if (isRecording) {
                    startRecognition(); // Tiếp tục nhận diện nếu không có lỗi
                }
            };

            // Kiểm tra nếu người dùng ngừng nói trong 3 giây
            silenceTimeout = setTimeout(function () {
                stopRecognition();
                document.getElementById('status').innerText = "Không có âm thanh nào.";
                document.getElementById('transcript').innerText = "Chưa nhận diện được giọng nói.";
            }, 3000); // Nếu không có âm thanh trong 3 giây thì dừng nhận diện
        }

        // Hàm dừng thu âm
        function stopRecognition() {
            isRecording = false;
            document.getElementById('recordButton').classList.remove('recording');
            document.getElementById('status').innerText = "";
            recognition.stop();
            clearTimeout(silenceTimeout); // Xóa timeout khi dừng thu âm
        }
    </script>

</body>

</html>